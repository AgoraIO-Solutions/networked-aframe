!function(e){function t(i){if(n[i])return n[i].exports;var o=n[i]={exports:{},id:i,loaded:!1};return e[i].call(o.exports,o,o.exports,t),o.loaded=!0,o.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(e,t,n){"use strict";n(1),n(12),n(13),n(11)},function(e,t,n){"use strict";var i=n(14),o=n(15),r=n(5),s=n(8),a=n(7),c=n(6),u=n(9),l={};l.app="",l.room="",l.clientId="",l.options=i,l.utils=o,l.log=new r,l.schemas=new s,l.version="0.6.1",l.adapters=new u;var d=new a,h=new c(d);l.connection=h,l.entities=d,e.exports=window.NAF=l},function(e,t){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),o=0,r=1,s=2,a=0,c=1,u=[],l=function(){var e=u.pop();return e||(e={position:new THREE.Vector3,velocity:new THREE.Vector3,scale:new THREE.Vector3,quaternion:new THREE.Quaternion,time:0}),e},d=function(e){return u.push(e)},h=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:a,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.15;n(this,e),this.state=o,this.buffer=[],this.bufferTime=1e3*i,this.time=0,this.mode=t,this.originFrame=l(),this.position=new THREE.Vector3,this.quaternion=new THREE.Quaternion,this.scale=new THREE.Vector3(1,1,1)}return i(e,[{key:"hermite",value:function(e,t,n,i,o,r){var s=t*t,a=t*t*t,c=2*a-3*s+1,u=-2*a+3*s,l=a-2*s+t,d=a-s;e.copy(n.multiplyScalar(c)),e.add(i.multiplyScalar(u)),e.add(o.multiplyScalar(l)),e.add(r.multiplyScalar(d))}},{key:"lerp",value:function(e,t,n,i){e.lerpVectors(t,n,i)}},{key:"slerp",value:function(e,t,n,i){THREE.Quaternion.slerp(t,n,e,i)}},{key:"updateOriginFrameToBufferTail",value:function(){d(this.originFrame),this.originFrame=this.buffer.shift()}},{key:"appendBuffer",value:function(e,t,n,i){var o=this.buffer.length>0?this.buffer[this.buffer.length-1]:null;if(o&&o.time===this.time)e&&o.position.copy(e),t&&o.velocity.copy(t),n&&o.quaternion.copy(n),i&&o.scale.copy(i);else{var r=o||this.originFrame,s=l();s.position.copy(e||r.position),s.velocity.copy(t||r.velocity),s.quaternion.copy(n||r.quaternion),s.scale.copy(i||r.scale),s.time=this.time,this.buffer.push(s)}}},{key:"setTarget",value:function(e,t,n,i){this.appendBuffer(e,t,n,i)}},{key:"setPosition",value:function(e,t){this.appendBuffer(e,t,null,null)}},{key:"setQuaternion",value:function(e){this.appendBuffer(null,null,e,null)}},{key:"setScale",value:function(e){this.appendBuffer(null,null,null,e)}},{key:"update",value:function(e){if(this.state===o&&this.buffer.length>0&&(this.updateOriginFrameToBufferTail(),this.position.copy(this.originFrame.position),this.quaternion.copy(this.originFrame.quaternion),this.scale.copy(this.originFrame.scale),this.state=r),this.state===r&&this.buffer.length>0&&this.time>this.bufferTime&&(this.state=s),this.state===s){for(var t=this.time-this.bufferTime;this.buffer.length>0&&t>this.buffer[0].time;)this.buffer.length>1?this.updateOriginFrameToBufferTail():(this.originFrame.position.copy(this.buffer[0].position),this.originFrame.velocity.copy(this.buffer[0].velocity),this.originFrame.quaternion.copy(this.buffer[0].quaternion),this.originFrame.scale.copy(this.buffer[0].scale),this.originFrame.time=this.buffer[0].time,this.buffer[0].time=this.time+e);if(this.buffer.length>0&&this.buffer[0].time>0){var n=this.buffer[0],i=n.time-this.originFrame.time,u=(t-this.originFrame.time)/i;this.mode===a?this.lerp(this.position,this.originFrame.position,n.position,u):this.mode===c&&this.hermite(this.position,u,this.originFrame.position,n.position,this.originFrame.velocity.multiplyScalar(i),n.velocity.multiplyScalar(i)),this.slerp(this.quaternion,this.originFrame.quaternion,n.quaternion,u),this.lerp(this.scale,this.originFrame.scale,n.scale,u)}}this.state!==o&&(this.time+=e)}},{key:"getPosition",value:function(){return this.position}},{key:"getQuaternion",value:function(){return this.quaternion}},{key:"getScale",value:function(){return this.scale}}]),e}();e.exports=h},function(e,t){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),o=function(){function e(){n(this,e),this.dict={}}return i(e,[{key:"addChild",value:function(e,t){this.hasParent(e)||(this.dict[e]=[]),this.dict[e].push(t)}},{key:"getChildren",value:function(e){if(!this.hasParent(e))return[];var t=this.dict[e];return delete this.dict[e],t}},{key:"hasParent",value:function(e){return!!this.dict[e]}}]),e}();e.exports=o},function(e,t){"use strict";var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i=Array.isArray,o=Object.keys,r=Object.prototype.hasOwnProperty;e.exports=function e(t,s){if(t===s)return!0;if(t&&s&&"object"==("undefined"==typeof t?"undefined":n(t))&&"object"==("undefined"==typeof s?"undefined":n(s))){var a,c,u,l=i(t),d=i(s);if(l&&d){if(c=t.length,c!=s.length)return!1;for(a=c;0!==a--;)if(!e(t[a],s[a]))return!1;return!0}if(l!=d)return!1;var h=t instanceof Date,f=s instanceof Date;if(h!=f)return!1;if(h&&f)return t.getTime()==s.getTime();var p=t instanceof RegExp,m=s instanceof RegExp;if(p!=m)return!1;if(p&&m)return t.toString()==s.toString();var v=o(t);if(c=v.length,c!==o(s).length)return!1;for(a=c;0!==a--;)if(!r.call(s,v[a]))return!1;for(a=c;0!==a--;)if(u=v[a],!e(t[u],s[u]))return!1;return!0}return t!==t&&s!==s}},function(e,t){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),o=function(){function e(){n(this,e),this.debug=!1}return i(e,[{key:"setDebug",value:function(e){this.debug=e}},{key:"write",value:function(){this.debug&&console.log.apply(this,arguments)}},{key:"warn",value:function(){console.warn.apply(this,arguments)}},{key:"error",value:function(){console.error.apply(this,arguments)}}]),e}();e.exports=o},function(e,t){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),o={Update:"u",UpdateMulti:"um",Remove:"r"},r=function(){function e(t){n(this,e),this.entities=t,this.setupDefaultDataSubscriptions(),this.connectedClients={},this.activeDataChannels={}}return i(e,[{key:"setNetworkAdapter",value:function(e){this.adapter=e}},{key:"setupDefaultDataSubscriptions",value:function(){this.dataChannelSubs={},this.dataChannelSubs[o.Update]=this.entities.updateEntity.bind(this.entities),this.dataChannelSubs[o.UpdateMulti]=this.entities.updateEntityMulti.bind(this.entities),this.dataChannelSubs[o.Remove]=this.entities.removeRemoteEntity.bind(this.entities)}},{key:"connect",value:function(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];NAF.app=t,NAF.room=n,this.adapter.setServerUrl(e),this.adapter.setApp(t),this.adapter.setRoom(n);var o={audio:i,video:!1,datachannel:!0};return this.adapter.setWebRtcOptions(o),this.adapter.setServerConnectListeners(this.connectSuccess.bind(this),this.connectFailure.bind(this)),this.adapter.setDataChannelListeners(this.dataChannelOpen.bind(this),this.dataChannelClosed.bind(this),this.receivedData.bind(this)),this.adapter.setRoomOccupantListener(this.occupantsReceived.bind(this)),this.adapter.connect()}},{key:"onConnect",value:function(e){this.onConnectCallback=e,this.isConnected()?e():document.body.addEventListener("connected",e,!1)}},{key:"connectSuccess",value:function(e){NAF.log.write("Networked-Aframe Client ID:",e),NAF.clientId=e;var t=new CustomEvent("connected",{detail:{clientId:e}});document.body.dispatchEvent(t)}},{key:"connectFailure",value:function(e,t){NAF.log.error(e,"failure to connect")}},{key:"occupantsReceived",value:function(e){var t=Object.assign({},this.connectedClients);this.connectedClients=e,this.checkForDisconnectingClients(t,e),this.checkForConnectingClients(e)}},{key:"checkForDisconnectingClients",value:function(e,t){for(var n in e){var i=t[n];i||(NAF.log.write("Closing stream to ",n),this.adapter.closeStreamConnection(n))}}},{key:"checkForConnectingClients",value:function(e){for(var t in e){var n=this.isNewClient(t)&&this.adapter.shouldStartConnectionTo(e[t]);n&&(NAF.log.write("Opening datachannel to ",t),this.adapter.startStreamConnection(t))}}},{key:"getConnectedClients",value:function(){return this.connectedClients}},{key:"isConnected",value:function(){return!!NAF.clientId}},{key:"isMineAndConnected",value:function(e){return this.isConnected()&&NAF.clientId===e}},{key:"isNewClient",value:function(e){return!this.isConnectedTo(e)}},{key:"isConnectedTo",value:function(e){return this.adapter.getConnectStatus(e)===NAF.adapters.IS_CONNECTED}},{key:"dataChannelOpen",value:function(e){NAF.log.write("Opened data channel from "+e),this.activeDataChannels[e]=!0,this.entities.completeSync(e,!0);var t=new CustomEvent("clientConnected",{detail:{clientId:e}});document.body.dispatchEvent(t)}},{key:"dataChannelClosed",value:function(e){NAF.log.write("Closed data channel from "+e),this.activeDataChannels[e]=!1,this.entities.removeEntitiesOfClient(e);var t=new CustomEvent("clientDisconnected",{detail:{clientId:e}});document.body.dispatchEvent(t)}},{key:"hasActiveDataChannel",value:function(e){return!(!this.activeDataChannels[e]||!this.activeDataChannels[e])}},{key:"broadcastData",value:function(e,t){this.adapter.broadcastData(e,t)}},{key:"broadcastDataGuaranteed",value:function(e,t){this.adapter.broadcastDataGuaranteed(e,t)}},{key:"sendData",value:function(e,t,n,i){this.hasActiveDataChannel(e)&&(i?this.adapter.sendDataGuaranteed(e,t,n):this.adapter.sendData(e,t,n))}},{key:"sendDataGuaranteed",value:function(e,t,n){this.sendData(e,t,n,!0)}},{key:"subscribeToDataChannel",value:function(e,t){return this.isReservedDataType(e)?void NAF.log.error("NetworkConnection@subscribeToDataChannel: "+e+" is a reserved dataType. Choose another"):void(this.dataChannelSubs[e]=t)}},{key:"unsubscribeToDataChannel",value:function(e){return this.isReservedDataType(e)?void NAF.log.error("NetworkConnection@unsubscribeToDataChannel: "+e+" is a reserved dataType. Choose another"):void delete this.dataChannelSubs[e]}},{key:"isReservedDataType",value:function(e){return e==o.Update||e==o.Remove}},{key:"receivedData",value:function(e,t,n,i){this.dataChannelSubs[t]?this.dataChannelSubs[t](e,t,n,i):NAF.log.write("NetworkConnection@receivedData: "+t+" has not been subscribed to yet. Call subscribeToDataChannel()")}},{key:"getServerTime",value:function(){return this.adapter.getServerTime()}},{key:"disconnect",value:function(){this.entities.removeRemoteEntities(),this.adapter.disconnect(),NAF.app="",NAF.room="",NAF.clientId="",this.connectedClients={},this.activeDataChannels={},this.adapter=null,this.setupDefaultDataSubscriptions(),document.body.removeEventListener("connected",this.onConnectCallback)}}]),e}();e.exports=r},function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),r=n(3),s=function(){function e(){i(this,e),this.entities={},this.childCache=new r,this.onRemoteEntityCreatedEvent=new Event("remoteEntityCreated"),this._persistentFirstSyncs={}}return o(e,[{key:"registerEntity",value:function(e,t){this.entities[e]=t}},{key:"createRemoteEntity",value:function(e){NAF.log.write("Creating remote entity",e);var t=e.networkId,n=NAF.schemas.getCachedTemplate(e.template);return n.setAttribute("id","naf-"+t),this.initPosition(n,e.components),this.initRotation(n,e.components),this.addNetworkComponent(n,e),this.registerEntity(t,n),n}},{key:"initPosition",value:function(e,t){var n=t.position;if(n){var i=t.position;e.setAttribute("position",i)}}},{key:"initRotation",value:function(e,t){var n=t.rotation;if(n){var i=t.rotation;e.setAttribute("rotation",i)}}},{key:"addNetworkComponent",value:function(e,t){var n={template:t.template,creator:t.creator,owner:t.owner,networkId:t.networkId,persistent:t.persistent};e.setAttribute("networked",n),e.firstUpdateData=t}},{key:"updateEntityMulti",value:function(e,t,n,i){if(!NAF.options.syncSource||i===NAF.options.syncSource)for(var o=0,r=n.d.length;o<r;o++)this.updateEntity(e,"u",n.d[o],i)}},{key:"updateEntity",value:function(e,t,n,i){if(!NAF.options.syncSource||i===NAF.options.syncSource){var o=n.networkId;this.hasEntity(o)?this.entities[o].components.networked.networkUpdate(n):n.isFirstSync&&(NAF.options.firstSyncSource&&i!==NAF.options.firstSyncSource?NAF.log.write("Ignoring first sync from disallowed source",i):n.persistent?this._persistentFirstSyncs[o]=n:this.receiveFirstUpdateFromEntity(n))}}},{key:"receiveFirstUpdateFromEntity",value:function(e){var t=e.parent,n=e.networkId,i=t&&!this.hasEntity(t);if(i)this.childCache.addChild(t,e);else{var o=this.createRemoteEntity(e);this.createAndAppendChildren(n,o),this.addEntityToPage(o,t)}}},{key:"createAndAppendChildren",value:function(e,t){for(var n=this.childCache.getChildren(e),i=0;i<n.length;i++){var o=n[i],r=o.networkId;if(this.hasEntity(r))NAF.log.warn("Tried to instantiate entity multiple times",r,o,"Existing entity:",this.getEntity(r));else{var s=this.createRemoteEntity(o);this.createAndAppendChildren(r,s),t.appendChild(s)}}}},{key:"addEntityToPage",value:function(e,t){this.hasEntity(t)?this.addEntityToParent(e,t):this.addEntityToSceneRoot(e)}},{key:"addEntityToParent",value:function(e,t){var n=document.getElementById("naf-"+t);n.appendChild(e)}},{key:"addEntityToSceneRoot",value:function(e){var t=document.querySelector("a-scene");t.appendChild(e)}},{key:"completeSync",value:function(e,t){for(var n in this.entities)this.entities[n]&&this.entities[n].components.networked.syncAll(e,t)}},{key:"removeRemoteEntity",value:function(e,t,n,i){if(!NAF.options.syncSource||i===NAF.options.syncSource){var o=n.networkId;return this.removeEntity(o)}}},{key:"removeEntitiesOfClient",value:function(e){var t=[];for(var n in this.entities){var i=NAF.utils.getCreator(this.entities[n]);if(i===e){var o=void 0,r=this.entities[n].getAttribute("networked");if(r&&r.persistent&&(o=NAF.utils.takeOwnership(this.entities[n])),!o){var s=this.removeEntity(n);t.push(s)}}}return t}},{key:"removeEntity",value:function(e){if(this.forgetPersistentFirstSync(e),this.hasEntity(e)){var t=this.entities[e];return this.forgetEntity(e),t.parentNode.removeChild(t),t}return NAF.log.error("Tried to remove entity I don't have."),null}},{key:"forgetEntity",value:function(e){delete this.entities[e],this.forgetPersistentFirstSync(e)}},{key:"getPersistentFirstSync",value:function(e){return this._persistentFirstSyncs[e]}},{key:"forgetPersistentFirstSync",value:function(e){delete this._persistentFirstSyncs[e]}},{key:"getEntity",value:function(e){return this.entities[e]?this.entities[e]:null}},{key:"hasEntity",value:function(e){return!!this.entities[e]}},{key:"removeRemoteEntities",value:function(){this.childCache=new r;for(var e in this.entities){var t=this.entities[e].getAttribute("networked").owner;t!=NAF.clientId&&this.removeEntity(e)}}}]),e}();e.exports=s},function(e,t){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),o=function(){function e(){n(this,e),this.schemaDict={},this.templateCache={}}return i(e,[{key:"createDefaultSchema",value:function(e){return{template:e,components:["position","rotation"]}}},{key:"add",value:function(e){if(this.validateSchema(e)){this.schemaDict[e.template]=e;var t=document.querySelector(e.template);if(!t)return void NAF.log.error("Template el not found for "+e.template+", make sure NAF.schemas.add is called after <a-scene> is defined.");if(!this.validateTemplate(e,t))return;this.templateCache[e.template]=document.importNode(t.content,!0)}else NAF.log.error("Schema not valid: ",e),NAF.log.error("See https://github.com/haydenjameslee/networked-aframe#syncing-custom-components")}},{key:"getCachedTemplate",value:function(e){return this.templateIsCached(e)||(this.templateExistsInScene(e)?this.add(this.createDefaultSchema(e)):NAF.log.error("Template el for "+e+" is not in the scene, add the template to <a-assets> and register with NAF.schemas.add.")),this.templateCache[e].firstElementChild.cloneNode(!0)}},{key:"templateIsCached",value:function(e){return!!this.templateCache[e]}},{key:"getComponents",value:function(e){var t=["position","rotation"];return this.hasTemplate(e)&&(t=this.schemaDict[e].components),t}},{key:"hasTemplate",value:function(e){return!!this.schemaDict[e]}},{key:"templateExistsInScene",value:function(e){var t=document.querySelector(e);return t&&this.isTemplateTag(t)}},{key:"validateSchema",value:function(e){return!(!e.template||!e.components)}},{key:"validateTemplate",value:function(e,t){return this.isTemplateTag(t)?!!this.templateHasOneOrZeroChildren(t)||(NAF.log.error("Template for "+e.template+" has more than one child. Templates must have one direct child element, no more. Template found:",t),!1):(NAF.log.error("Template for "+e.template+" is not a <template> tag. Instead found: "+t.tagName),!1)}},{key:"isTemplateTag",value:function(e){return"template"===e.tagName.toLowerCase()}},{key:"templateHasOneOrZeroChildren",value:function(e){return e.content.childElementCount<2}},{key:"remove",value:function(e){delete this.schemaDict[e]}},{key:"clear",value:function(){this.schemaDict={}}}]),e}();e.exports=o},function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),r=n(10),s=function(){function e(){i(this,e),this.adapters={"native-webrtc":r},this.IS_CONNECTED=e.IS_CONNECTED,this.CONNECTING=e.CONNECTING,this.NOT_CONNECTED=e.NOT_CONNECTED}return o(e,[{key:"register",value:function(e,t){this.adapters[e]=t}},{key:"make",value:function(e){var t=e.toLowerCase();if(this.adapters[t]){var n=this.adapters[t];return new n}throw new Error("Adapter: "+e+" not registered. Please use NAF.adapters.register() to register this adapter.")}}]),e}();s.IS_CONNECTED="IS_CONNECTED",s.CONNECTING="CONNECTING",s.NOT_CONNECTED="NOT_CONNECTED",e.exports=s},function(e,t){"use strict";var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};!function(e){function t(n){if(i[n])return i[n].exports;var o=i[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,t),o.l=!0,o.exports}var i={};return t.m=e,t.c=i,t.d=function(e,n,i){t.o(e,n)||Object.defineProperty(e,n,{enumerable:!0,get:i})},t.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t.t=function(e,i){if(1&i&&(e=t(e)),8&i)return e;if(4&i&&"object"===("undefined"==typeof e?"undefined":n(e))&&e&&e.__esModule)return e;var o=Object.create(null);if(t.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&i&&"string"!=typeof e)for(var r in e)t.d(o,r,function(t){return e[t]}.bind(null,r));return o},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s="./src/index.js")}({"./src/WebRtcPeer.js":/*!***************************!*\
	    !*** ./src/WebRtcPeer.js ***!
	    \***************************/
/*! no static exports found */
function(e,t,n){function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),r=function(){function e(t,n,o){i(this,e),this.localId=t,this.remoteId=n,this.sendSignalFunc=o,this.open=!1,this.channelLabel="networked-aframe-channel",this.pc=this.createPeerConnection(),this.channel=null}return o(e,[{key:"setDatachannelListeners",value:function(e,t,n,i){this.openListener=e,this.closedListener=t,this.messageListener=n,this.trackListener=i}},{key:"offer",value:function(e){var t=this;this.setupChannel(this.pc.createDataChannel(this.channelLabel,{reliable:!1})),e.sendAudio&&e.localAudioStream.getTracks().forEach(function(n){return t.pc.addTrack(n,e.localAudioStream)}),this.pc.createOffer(function(e){t.handleSessionDescription(e)},function(e){NAF.log.error("WebRtcPeer.offer: "+e)},{offerToReceiveAudio:!0,offerToReceiveVideo:!1})}},{key:"handleSignal",value:function(e){if(this.localId===e.to&&this.remoteId===e.from)switch(e.type){case"offer":this.handleOffer(e);break;case"answer":this.handleAnswer(e);break;case"candidate":this.handleCandidate(e);break;default:NAF.log.error("WebRtcPeer.handleSignal: Unknown signal type "+e.type)}}},{key:"send",value:function(e,t){null!==this.channel&&"open"===this.channel.readyState&&this.channel.send(JSON.stringify({type:e,data:t}))}},{key:"getStatus",value:function(){if(null===this.channel)return e.NOT_CONNECTED;switch(this.channel.readyState){case"open":return e.IS_CONNECTED;case"connecting":return e.CONNECTING;case"closing":case"closed":default:return e.NOT_CONNECTED}}},{key:"createPeerConnection",value:function(){var t=this,n=window.RTCPeerConnection||window.webkitRTCPeerConnection||window.mozRTCPeerConnection||window.msRTCPeerConnection;if(void 0===n)throw new Error("WebRtcPeer.createPeerConnection: This browser does not seem to support WebRTC.");var i=new n({iceServers:e.ICE_SERVERS});return i.onicecandidate=function(e){e.candidate&&t.sendSignalFunc({from:t.localId,to:t.remoteId,type:"candidate",sdpMLineIndex:e.candidate.sdpMLineIndex,candidate:e.candidate.candidate})},i.oniceconnectionstatechange=function(){t.open&&"disconnected"===i.iceConnectionState&&(t.open=!1,t.closedListener(t.remoteId))},i.ontrack=function(e){t.trackListener(t.remoteId,e.streams[0])},i}},{key:"setupChannel",value:function(e){var t=this;this.channel=e,this.channel.onmessage=function(e){var n=JSON.parse(e.data);t.messageListener(t.remoteId,n.type,n.data)},this.channel.onopen=function(e){t.open=!0,t.openListener(t.remoteId)},this.channel.onclose=function(e){t.open&&(t.open=!1,t.closedListener(t.remoteId))},this.channel.onerror=function(e){NAF.log.error("WebRtcPeer.channel.onerror: "+e)}}},{key:"handleOffer",value:function(e){var t=this;this.pc.ondatachannel=function(e){t.setupChannel(e.channel)},this.setRemoteDescription(e),this.pc.createAnswer(function(e){t.handleSessionDescription(e)},function(e){NAF.log.error("WebRtcPeer.handleOffer: "+e)})}},{key:"handleAnswer",value:function(e){this.setRemoteDescription(e)}},{key:"handleCandidate",value:function(e){var t=window.RTCIceCandidate||window.webkitRTCIceCandidate||window.mozRTCIceCandidate;this.pc.addIceCandidate(new t(e),function(){},function(e){NAF.log.error("WebRtcPeer.handleCandidate: "+e)})}},{key:"handleSessionDescription",value:function(e){this.pc.setLocalDescription(e,function(){},function(e){NAF.log.error("WebRtcPeer.handleSessionDescription: "+e)}),this.sendSignalFunc({from:this.localId,to:this.remoteId,type:e.type,sdp:e.sdp})}},{key:"setRemoteDescription",value:function(e){var t=window.RTCSessionDescription||window.webkitRTCSessionDescription||window.mozRTCSessionDescription||window.msRTCSessionDescription;this.pc.setRemoteDescription(new t(e),function(){},function(e){NAF.log.error("WebRtcPeer.setRemoteDescription: "+e)})}},{key:"close",value:function(){this.pc&&this.pc.close()}}]),e}();r.IS_CONNECTED="IS_CONNECTED",r.CONNECTING="CONNECTING",r.NOT_CONNECTED="NOT_CONNECTED",r.ICE_SERVERS=[{urls:"stun:stun1.l.google.com:19302"},{urls:"stun:stun2.l.google.com:19302"},{urls:"stun:stun3.l.google.com:19302"},{urls:"stun:stun4.l.google.com:19302"}],e.exports=r},"./src/index.js":/*!**********************!*\
	    !*** ./src/index.js ***!
	    \**********************/
/*! no static exports found */
function(e,t,n){function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),r=n(/*! ./WebRtcPeer */"./src/WebRtcPeer.js"),s=function(){function e(){i(this,e),void 0===io&&console.warn("It looks like socket.io has not been loaded before NativeWebRtcAdapter. Please do that."),this.app="default",this.room="default",this.occupantListener=null,this.myRoomJoinTime=null,this.myId=null,this.avgTimeOffset=0,this.peers={},this.occupants={},this.audioStreams={},this.pendingAudioRequest={},this.serverTimeRequests=0,this.timeOffsets=[],this.avgTimeOffset=0}return o(e,[{key:"setServerUrl",value:function(e){this.wsUrl=e}},{key:"setApp",value:function(e){this.app=e}},{key:"setRoom",value:function(e){this.room=e}},{key:"setWebRtcOptions",value:function(e){e.datachannel===!1&&NAF.log.error("NativeWebRtcAdapter.setWebRtcOptions: datachannel must be true."),e.audio===!0&&(this.sendAudio=!0),e.video===!0&&NAF.log.warn("NativeWebRtcAdapter does not support video yet.")}},{key:"setServerConnectListeners",value:function(e,t){this.connectSuccess=e,this.connectFailure=t}},{key:"setRoomOccupantListener",value:function(e){this.occupantListener=e}},{key:"setDataChannelListeners",value:function(e,t,n){this.openListener=e,this.closedListener=t,this.messageListener=n}},{key:"connect",value:function(){var e=this;this.updateTimeOffset().then(function(){function t(t){var n=t.from,i=t.type,o=t.data;return"ice-candidate"===i?void e.peers[n].handleSignal(o):void e.messageListener(n,i,o)}e.wsUrl&&"/"!==e.wsUrl||("https:"===location.protocol?e.wsUrl="wss://"+location.host:e.wsUrl="ws://"+location.host),NAF.log.write("Attempting to connect to socket.io");var n=e.socket=io(e.wsUrl);n.on("connect",function(){NAF.log.write("User connected",n.id),e.myId=n.id,e.joinRoom()}),n.on("connectSuccess",function(t){var n=t.joinedTime;if(e.myRoomJoinTime=n,NAF.log.write("Successfully joined room",e.room,"at server time",n),e.sendAudio){var i={audio:!0,video:!1};navigator.mediaDevices.getUserMedia(i).then(function(t){e.storeAudioStream(e.myId,t),e.connectSuccess(e.myId)}).catch(function(e){return NAF.log.error(e)})}else e.connectSuccess(e.myId)}),n.on("error",function(t){console.error("Socket connection failure",t),e.connectFailure()}),n.on("occupantsChanged",function(t){var n=t.occupants;NAF.log.write("occupants changed",t),e.receivedOccupants(n)}),n.on("send",t),n.on("broadcast",t)})}},{key:"joinRoom",value:function(){NAF.log.write("Joining room",this.room),this.socket.emit("joinRoom",{room:this.room})}},{key:"receivedOccupants",value:function(e){var t=this;delete e[this.myId],this.occupants=e,NAF.log.write("occupants=",e);var n=this,i=this.myId,o=function(){var e=s;if(t.peers[e])return"continue";var o=new r(i,e,function(t){n.socket.emit("send",{from:i,to:e,type:"ice-candidate",data:t,sending:!0})});o.setDatachannelListeners(n.openListener,n.closedListener,n.messageListener,n.trackListener.bind(n)),n.peers[e]=o};for(var s in e){o()}this.occupantListener(e)}},{key:"shouldStartConnectionTo",value:function(e){return(this.myRoomJoinTime||0)<=(e||0)}},{key:"startStreamConnection",value:function(e){var t=this;NAF.log.write("starting offer process"),this.sendAudio?this.getMediaStream(this.myId).then(function(n){var i={sendAudio:!0,localAudioStream:n};t.peers[e].offer(i)}):this.peers[e].offer({})}},{key:"closeStreamConnection",value:function(e){NAF.log.write("closeStreamConnection",e,this.peers),this.peers[e].close(),delete this.peers[e],delete this.occupants[e],this.closedListener(e)}},{key:"getConnectStatus",value:function(e){var t=this.peers[e];if(void 0===t)return NAF.adapters.NOT_CONNECTED;switch(t.getStatus()){case r.IS_CONNECTED:return NAF.adapters.IS_CONNECTED;case r.CONNECTING:return NAF.adapters.CONNECTING;case r.NOT_CONNECTED:default:return NAF.adapters.NOT_CONNECTED}}},{key:"sendData",value:function(e,t,n){this.peers[e].send(t,n)}},{key:"sendDataGuaranteed",value:function(e,t,n){var i={from:this.myId,to:e,type:t,data:n,sending:!0};this.socket.emit("send",i)}},{key:"broadcastData",value:function(e,t){for(var n in this.peers)this.sendData(n,e,t)}},{key:"broadcastDataGuaranteed",value:function(e,t){var n={from:this.myId,type:e,data:t,broadcasting:!0};this.socket.emit("broadcast",n)}},{key:"storeAudioStream",value:function(e,t){this.audioStreams[e]=t,this.pendingAudioRequest[e]&&(NAF.log.write("Received pending audio for "+e),this.pendingAudioRequest[e](t),delete this.pendingAudioRequest[e](t))}},{key:"trackListener",value:function(e,t){this.storeAudioStream(e,t)}},{key:"getMediaStream",value:function(e){var t=this;return this.audioStreams[e]?(NAF.log.write("Already had audio for "+e),Promise.resolve(this.audioStreams[e])):(NAF.log.write("Waiting on audio for "+e),new Promise(function(n){t.pendingAudioRequest[e]=n}))}},{key:"updateTimeOffset",value:function(){var e=this,t=Date.now()+this.avgTimeOffset;return fetch(document.location.href,{method:"HEAD",cache:"no-cache"}).then(function(n){var i=1e3,o=new Date(n.headers.get("Date")).getTime()+i/2,r=Date.now(),s=o+(r-t)/2,a=s-r;e.serverTimeRequests++,e.serverTimeRequests<=10?e.timeOffsets.push(a):e.timeOffsets[e.serverTimeRequests%10]=a,e.avgTimeOffset=e.timeOffsets.reduce(function(e,t){return e+=t},0)/e.timeOffsets.length,e.serverTimeRequests>10?setTimeout(function(){return e.updateTimeOffset()},3e5):e.updateTimeOffset()})}},{key:"getServerTime",value:function(){return-1}}]),e}();NAF.adapters.register("native-webrtc",s),e.exports=s}})},function(e,t,n){"use strict";var i=n(1);AFRAME.registerComponent("networked-audio-source",{schema:{positional:{default:!0},distanceModel:{default:"inverse",oneOf:["linear","inverse","exponential"]},maxDistance:{default:1e4},refDistance:{default:1},rolloffFactor:{default:1}},init:function(){var e=this;this.listener=null,this.stream=null,this._setMediaStream=this._setMediaStream.bind(this),NAF.utils.getNetworkedEntity(this.el).then(function(t){var n=t.components.networked.data.owner;n&&NAF.connection.adapter.getMediaStream(n).then(e._setMediaStream).catch(function(e){return i.log.error("Error getting media stream for "+n,e)})})},update:function(){this._setPannerProperties()},_setMediaStream:function(e){if(this.sound||this.setupSound(),e!=this.stream){if(this.stream&&this.sound.disconnect(),e){/chrome/i.test(navigator.userAgent)&&(this.audioEl=new Audio,this.audioEl.setAttribute("autoplay","autoplay"),this.audioEl.setAttribute("playsinline","playsinline"),this.audioEl.srcObject=e,this.audioEl.volume=0);var t=this.sound.context.createMediaStreamSource(e);this.sound.setNodeSource(t),this.el.emit("sound-source-set",{soundSource:t})}this.stream=e}},_setPannerProperties:function(){this.sound&&this.data.positional&&(this.sound.setDistanceModel(this.data.distanceModel),this.sound.setMaxDistance(this.data.maxDistance),this.sound.setRefDistance(this.data.refDistance),this.sound.setRolloffFactor(this.data.rolloffFactor))},remove:function(){this.sound&&(this.el.removeObject3D(this.attrName),this.stream&&this.sound.disconnect())},setupSound:function(){var e=this.el,t=e.sceneEl;this.sound&&e.removeObject3D(this.attrName),t.audioListener||(t.audioListener=new THREE.AudioListener,t.camera&&t.camera.add(t.audioListener),t.addEventListener("camera-set-active",function(e){e.detail.cameraEl.getObject3D("camera").add(t.audioListener)})),this.listener=t.audioListener,this.sound=this.data.positional?new THREE.PositionalAudio(this.listener):new THREE.Audio(this.listener),e.setObject3D(this.attrName,this.sound),this._setPannerProperties()}})},function(e,t){"use strict";AFRAME.registerComponent("networked-scene",{schema:{serverURL:{default:"/"},app:{default:"default"},room:{default:"default"},connectOnLoad:{default:!0},onConnect:{default:"onConnect"},adapter:{default:"wsEasyRtc"},audio:{default:!1},debug:{default:!1}},init:function(){var e=this.el;this.connect=this.connect.bind(this),e.addEventListener("connect",this.connect),this.data.connectOnLoad&&e.emit("connect",null,!1)},connect:function(){return NAF.log.setDebug(this.data.debug),NAF.log.write("Networked-Aframe Connecting..."),this.checkDeprecatedProperties(),this.setupNetworkAdapter(),this.hasOnConnectFunction()&&this.callOnConnect(),NAF.connection.connect(this.data.serverURL,this.data.app,this.data.room,this.data.audio)},checkDeprecatedProperties:function(){},setupNetworkAdapter:function(){var e=this.data.adapter,t=NAF.adapters.make(e);NAF.connection.setNetworkAdapter(t),this.el.emit("adapter-ready",t,!1)},hasOnConnectFunction:function(){return""!=this.data.onConnect&&window[this.data.onConnect]},callOnConnect:function(){NAF.connection.onConnect(window[this.data.onConnect])},remove:function(){NAF.log.write("networked-scene disconnected"),this.el.removeEventListener("connect",this.connect),NAF.connection.disconnect()}})},function(e,t,n){"use strict";function i(){var e=null;return function(t){return(null===e||!o(e,t))&&(e=AFRAME.utils.clone(t),!0)}}var o=n(4),r=n(2),s=THREE.Math.DEG2RAD,a=["position","rotation","scale"];AFRAME.registerSystem("networked",{init:function(){this.components=[],this.nextSyncTime=0},register:function(e){this.components.push(e)},deregister:function(e){var t=this.components.indexOf(e);t>-1&&this.components.splice(t,1)},tick:function(){return function(){if(NAF.connection.adapter&&!(this.el.clock.elapsedTime<this.nextSyncTime)){for(var e={d:[]},t=0,n=this.components.length;t<n;t++){var i=this.components[t];if(i.isMine()){if(!i.el.parentElement)return void NAF.log.error("entity registered with system despite being removed");var o=this.components[t].syncDirty();o&&e.d.push(o)}}e.d.length>0&&NAF.connection.broadcastData("um",e),this.updateNextSyncTime()}}}(),updateNextSyncTime:function(){this.nextSyncTime=this.el.clock.elapsedTime+1/NAF.options.updateRate}}),AFRAME.registerComponent("networked",{schema:{template:{default:""},attachTemplateToLocal:{default:!0},persistent:{default:!1},networkId:{default:""},owner:{default:""},creator:{default:""}},init:function(){this.OWNERSHIP_GAINED="ownership-gained",this.OWNERSHIP_CHANGED="ownership-changed",this.OWNERSHIP_LOST="ownership-lost",this.onOwnershipGainedEvent={el:this.el},this.onOwnershipChangedEvent={el:this.el},this.onOwnershipLostEvent={el:this.el},this.conversionEuler=new THREE.Euler,this.conversionEuler.order="YXZ",this.bufferInfos=[],this.bufferPosition=new THREE.Vector3,this.bufferQuaternion=new THREE.Quaternion,this.bufferScale=new THREE.Vector3;var e=this.wasCreatedByNetwork();this.onConnected=this.onConnected.bind(this),this.syncData={},this.componentSchemas=NAF.schemas.getComponents(this.data.template),this.cachedElements=new Array(this.componentSchemas.length),this.networkUpdatePredicates=this.componentSchemas.map(function(e){return e.requiresNetworkUpdate&&e.requiresNetworkUpdate()||i()}),this.invalidateCachedElements(),this.initNetworkParent(),""===this.data.networkId&&this.el.setAttribute(this.name,{networkId:NAF.utils.createNetworkId()}),e?this.firstUpdate():(this.data.attachTemplateToLocal&&this.attachTemplateToLocal(),this.registerEntity(this.data.networkId)),this.lastOwnerTime=-1,NAF.clientId?this.onConnected():document.body.addEventListener("connected",this.onConnected,!1),document.body.dispatchEvent(this.entityCreatedEvent()),this.el.dispatchEvent(new CustomEvent("instantiated",{detail:{el:this.el}})),this.el.sceneEl.systems.networked.register(this)},attachTemplateToLocal:function(){for(var e=NAF.schemas.getCachedTemplate(this.data.template),t=e.attributes,n=0;n<t.length;n++)this.el.setAttribute(t[n].name,t[n].value);for(;e.firstElementChild;)this.el.appendChild(e.firstElementChild)},takeOwnership:function(){var e=this.data.owner,t=this.lastOwnerTime,n=NAF.connection.getServerTime();return!!(e&&!this.isMine()&&t<n)&&(this.lastOwnerTime=n,this.removeLerp(),this.el.setAttribute("networked",{owner:NAF.clientId}),this.syncAll(),this.onOwnershipGainedEvent.oldOwner=e,this.el.emit(this.OWNERSHIP_GAINED,this.onOwnershipGainedEvent),this.onOwnershipChangedEvent.oldOwner=e,this.onOwnershipChangedEvent.newOwner=NAF.clientId,this.el.emit(this.OWNERSHIP_CHANGED,this.onOwnershipChangedEvent),!0)},wasCreatedByNetwork:function(){return!!this.el.firstUpdateData},initNetworkParent:function(){var e=this.el.parentElement;e.components&&e.components.networked?this.parent=e:this.parent=null},registerEntity:function(e){NAF.entities.registerEntity(e,this.el)},applyPersistentFirstSync:function(){var e=this.data.networkId,t=NAF.entities.getPersistentFirstSync(e);t&&(this.networkUpdate(t),NAF.entities.forgetPersistentFirstSync(e))},firstUpdate:function(){var e=this.el.firstUpdateData;this.networkUpdate(e)},onConnected:function(){var e=this;""===this.data.owner&&(this.lastOwnerTime=NAF.connection.getServerTime(),this.el.setAttribute(this.name,{owner:NAF.clientId,creator:NAF.clientId}),setTimeout(function(){return e.el.parentNode?void e.syncAll(void 0,!0):void NAF.log.warn("Networked element was removed before ever getting the chance to syncAll")},0)),document.body.removeEventListener("connected",this.onConnected,!1)},isMine:function(){return this.data.owner===NAF.clientId},createdByMe:function(){return this.data.creator===NAF.clientId},tick:function(e,t){if(!this.isMine()&&NAF.options.useLerp)for(var n=0;n<this.bufferInfos.length;n++){var i=this.bufferInfos[n],o=i.buffer,r=i.object3D,s=i.componentNames;o.update(t),s.includes("position")&&r.position.copy(o.getPosition()),s.includes("rotation")&&r.quaternion.copy(o.getQuaternion()),s.includes("scale")&&r.scale.copy(o.getScale())}},syncAll:function(e,t){if(this.canSync()){var n=this.gatherComponentsData(!0),i=this.createSyncData(n,t);e?NAF.connection.sendDataGuaranteed(e,"u",i):NAF.connection.broadcastDataGuaranteed("u",i)}},syncDirty:function(){if(this.canSync()){var e=this.gatherComponentsData(!1);if(null!==e)return this.createSyncData(e)}},getCachedElement:function(e){var t=this.cachedElements[e];if(t)return t;var n=this.componentSchemas[e];return n.selector?this.cachedElements[e]=this.el.querySelector(n.selector):this.cachedElements[e]=this.el},invalidateCachedElements:function(){for(var e=0;e<this.cachedElements.length;e++)this.cachedElements[e]=null},gatherComponentsData:function(e){for(var t=null,n=0;n<this.componentSchemas.length;n++){var i=this.componentSchemas[n],o=this.getCachedElement(n);if(o){var r=i.component?i.component:i,s=o.getAttribute(r);if(null!==s){var a=i.property?s[i.property]:s;(this.networkUpdatePredicates[n](a)||e)&&(t=t||{},t[n]=a)}else e&&(t=t||{},t[n]=null)}else e&&(t=t||{},t[n]=null)}return t},createSyncData:function(e,t){var n=this.syncData,i=this.data;return n.networkId=i.networkId,n.owner=i.owner,n.creator=i.creator,n.lastOwnerTime=this.lastOwnerTime,n.template=i.template,n.persistent=i.persistent,n.parent=this.getParentId(),n.components=e,n.isFirstSync=!!t,n},canSync:function(){if(this.data.owner&&this.isMine())return!0;if(!this.createdByMe())return!1;var e=NAF.connection.getConnectedClients();for(var t in e)if(t===this.data.owner)return!1;return!0},getParentId:function(){if(this.initNetworkParent(),!this.parent)return null;var e=this.parent.getAttribute("networked");return e.networkId},networkUpdate:function(e){if(!(e.lastOwnerTime<this.lastOwnerTime||this.lastOwnerTime===e.lastOwnerTime&&this.data.owner>e.owner)){if(this.data.owner!==e.owner){var t=this.isMine();this.lastOwnerTime=e.lastOwnerTime;var n=this.data.owner,i=e.owner;this.el.setAttribute("networked",{owner:e.owner}),t&&(this.onOwnershipLostEvent.newOwner=i,this.el.emit(this.OWNERSHIP_LOST,this.onOwnershipLostEvent)),this.onOwnershipChangedEvent.oldOwner=n,this.onOwnershipChangedEvent.newOwner=i,this.el.emit(this.OWNERSHIP_CHANGED,this.onOwnershipChangedEvent)}this.data.persistent!==e.persistent&&this.el.setAttribute("networked",{persistent:e.persistent}),this.updateNetworkedComponents(e.components)}},updateNetworkedComponents:function(e){for(var t=0,n=this.componentSchemas.length;t<n;t++){var i=e[t],o=this.componentSchemas[t],r=this.getCachedElement(t);null!==r&&null!==i&&void 0!==i&&(o.component?o.property?this.updateNetworkedComponent(r,o.component,o.property,i):this.updateNetworkedComponent(r,o.component,i):this.updateNetworkedComponent(r,o,i))}},updateNetworkedComponent:function(e,t,n,i){if(!NAF.options.useLerp||!a.includes(t))return void(void 0===i?e.setAttribute(t,n):e.setAttribute(t,n,i));for(var o=void 0,c=0,u=this.bufferInfos.length;c<u;c++){var l=this.bufferInfos[c];if(l.object3D===e.object3D){o=l;break}}if(o){var d=o.componentNames;d.includes(t)||d.push(t)}else o={buffer:new r(r.MODE_LERP,.1),object3D:e.object3D,componentNames:[t]},this.bufferInfos.push(o);var h=o.buffer;switch(t){case"position":return void h.setPosition(this.bufferPosition.set(n.x,n.y,n.z));case"rotation":return this.conversionEuler.set(s*n.x,s*n.y,s*n.z),void h.setQuaternion(this.bufferQuaternion.setFromEuler(this.conversionEuler));case"scale":return void h.setScale(this.bufferScale.set(n.x,n.y,n.z))}NAF.log.error("Could not set value in interpolation buffer.",e,t,n,o)},removeLerp:function(){this.bufferInfos=[]},remove:function(){if(this.isMine()&&NAF.connection.isConnected()){var e={networkId:this.data.networkId};NAF.entities.hasEntity(this.data.networkId)?NAF.connection.broadcastDataGuaranteed("r",e):NAF.log.error("Removing networked entity that is not in entities array.")}NAF.entities.forgetEntity(this.data.networkId),document.body.dispatchEvent(this.entityRemovedEvent(this.data.networkId)),this.el.sceneEl.systems.networked.deregister(this)},entityCreatedEvent:function(){return new CustomEvent("entityCreated",{detail:{el:this.el}})},entityRemovedEvent:function(e){return new CustomEvent("entityRemoved",{detail:{networkId:e}})}})},function(e,t){"use strict";var n={debug:!1,updateRate:15,useLerp:!0,firstSyncSource:null,syncSource:null};e.exports=n},function(e,t){"use strict";function n(e){return new Promise(function(t,n){for(var i=e;i&&i.components&&!i.components.networked;)i=i.parentNode;return i&&i.components&&i.components.networked?void(i.hasLoaded?t(i):i.addEventListener("instantiated",function(){t(i)},{once:!0})):n("Entity does not have and is not a child of an entity with the [networked] component ")})}e.exports.whenEntityLoaded=function(e,t){e.hasLoaded&&t(),e.addEventListener("loaded",function(){t()})},e.exports.createHtmlNodeFromString=function(e){var t=document.createElement("div");t.innerHTML=e;var n=t.firstChild;return n},e.exports.getCreator=function(e){var t=e.components;return t.networked?t.networked.data.creator:null},e.exports.getNetworkOwner=function(e){var t=e.components;return t.networked?t.networked.data.owner:null},e.exports.getNetworkId=function(e){var t=e.components;return t.networked?t.networked.data.networkId:null},e.exports.now=function(){return Date.now()},e.exports.createNetworkId=function(){return Math.random().toString(36).substring(2,9)},e.exports.getNetworkedEntity=n,e.exports.takeOwnership=function(e){for(var t=e;t&&t.components&&!t.components.networked;)t=t.parentNode;if(!t||!t.components||!t.components.networked)throw new Error("Entity does not have and is not a child of an entity with the [networked] component ");return t.components.networked.takeOwnership()},e.exports.isMine=function(e){for(var t=e;t&&t.components&&!t.components.networked;)t=t.parentNode;if(!t||!t.components||!t.components.networked)throw new Error("Entity does not have and is not a child of an entity with the [networked] component ");return t.components.networked.data.owner===NAF.clientId},e.exports.almostEqualVec3=function(e,t,n){return Math.abs(e.x-t.x)<n&&Math.abs(e.y-t.y)<n&&Math.abs(e.z-t.z)<n}}]);